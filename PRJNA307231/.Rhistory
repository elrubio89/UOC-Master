knitr::opts_chunk$set(echo = TRUE)
setwd("~/Documentos/Repos/UOC-Master/testOutputs")
library(readr)
library(knitr)
library(dplyr)
setwd("~/Documentos/Repos/UOC-Master/testOutputs")
out_card <- read_delim("ARIBA/out.card.tsv",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
kable(head(out_card))
kable(out_card)
install.packages("rmarkdown")
library(readr)
library(knitr)
library(dplyr)
setwd("~/Documentos/Repos/UOC-Master/testOutputs")
out_card <- read_delim("ARIBA/out.card.tsv",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
kable(head(out_card))
n_distinct(out_card$X1)
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Documentos/Repos/UOC-Master/testOutputs")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "~/Documentos/Repos/UOC-Master/testOutputs")
library(readr)
setwd("~/Documentos/UOCMaster/RTC/RGI_analysis")
library(readr)
gene_mapping_data <- read_delim("RGI/RTC_149_RGI_output.gene_mapping_data.txt", "\t", escape_double = FALSE, trim_ws = TRUE)
allele_mapping_data <- read_delim("RGI/RTC_149_RGI_output.allele_mapping_data.txt", "\t", escape_double = FALSE, trim_ws = TRUE)
library(dplyr)
totalMapReads<-19968 ##value obtained from *overall_mapping_stats.txt
totalNumReads<-	17072992
allele_mapping_data<-allele_mapping_data%>%mutate(RPKM=`All Mapped Reads` /(`Reference Length`/1000 * totalNumReads/1000000))
gene_mapping_data<-gene_mapping_data%>%mutate(RPKM=`All Mapped Reads` /(`Reference Length`/1000 * totalNumReads/1000000))
library(ggplot2)
ggplot(allele_mapping_data, aes(`Average MAPQ (Completely Mapped Reads)`)) +
geom_histogram(bins=50, aes(y = stat(density)))+geom_density()+theme_bw()
ggplot(allele_mapping_data, aes(`Average MAPQ (Completely Mapped Reads)`)) +
geom_histogram(bins=50)+theme_bw()
allele_mapping_data<-allele_mapping_data%>%filter(`Average MAPQ (Completely Mapped Reads)`>10)
library(knitr)
n_distinct(allele_mapping_data$`AMR Gene Family`)
AMR_family_RGI<-allele_mapping_data%>%
group_by(`AMR Gene Family`)%>%
summarise('number of AMR genes per family (RGI)'=n(),
sum_RPKM_RGI=sum(RPKM),
avg_MAPQ=mean(`Average MAPQ (Completely Mapped Reads)`),
q1_MAPQ=quantile(`Average MAPQ (Completely Mapped Reads)`, 0.25),
p3_MAPQ=quantile(`Average MAPQ (Completely Mapped Reads)`,0.75),)%>%arrange(desc(sum_RPKM_RGI))
kable(head(AMR_family_RGI))
str(AMR_family_RGI$`sum RPKM (RGI)`)
report <- read_delim("ARIBA/report.tsv",
"\t", escape_double = FALSE, trim_ws = TRUE)
report<-report%>% filter(gene==1)%>%select(c(1:8,31))%>%unique()
totalNumReads<-	17072992
report<-report%>%mutate(RPKM=reads /(ref_len/1000 * totalNumReads/1000000))
library(readr)
aro_index <- read_delim("aro_index.tsv",
"\t", escape_double = FALSE, trim_ws = TRUE)
library(stringr)
library(reshape2)
y<-colsplit(report$ref_name, "\\.", c("ARO Term", "ARO Acession","NCBI","init_final","Model Sequence ID","X"))
y$NCBI<-ifelse(str_detect(y$init_final, "_"),y$NCBI ,paste(y$NCBI,".",y$init_final) )
y$init_final<-ifelse(str_detect(y$init_final, "_"), y$init_final, y$`Model Sequence ID`)
y$`Model Sequence ID`<-ifelse(str_detect(y$`Model Sequence ID`, "_"), y$X, y$`Model Sequence ID`)
y<-select(y, -X)
report<-cbind(report,y)
report<-merge(report, select(aro_index,`Model Sequence ID`, `AMR Gene Family`,`Drug Class`, `Resistance Mechanism` ) , by="Model Sequence ID")
str(report$rp)
View(report)
library(knitr)
library(dplyr)
AMR_family_ARIBA<-report%>%
group_by(`AMR Gene Family`)%>%
summarise('number of AMR genes per family(ARIBA)'=n(),
'sum RPKM (ARIBA)'=sum(RPKM))%>%arrange(desc('sum RPKM (ARIBA)'))
kable(head(AMR_family_ARIBA))
library(readr)
groot_report <- read_delim("Groot/filtered_RTC_149-report-0",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
names(groot_report)<-c("AMR.gene", "read.count", "gene.length", "coverage.cigar")
head(groot_report)
library(stringr)
library(reshape2)
library(dplyr)
y<-colsplit(groot_report$AMR.gene, "\\.", c("ARO Term", "ARO Acession","NCBI","init_final","Model Sequence ID","X"))
y$NCBI<-ifelse(str_detect(y$init_final, "-"),y$NCBI ,paste(y$NCBI,".",y$init_final) )
y$init_final<-ifelse(str_detect(y$init_final, "-"), y$init_final, y$`Model Sequence ID`)
y$`Model Sequence ID`<-ifelse(str_detect(y$`Model Sequence ID`, "-"), y$X, y$`Model Sequence ID`)
y<-select(y, -X)
groot_report<-cbind(groot_report,y)
groot_report<-merge(groot_report, select(aro_index,`Model Sequence ID`, `AMR Gene Family`,`Drug Class`, `Resistance Mechanism` ) , by="Model Sequence ID")
otalNumReads<-	17072992
groot_report<-groot_report%>%mutate(RPKM=read.count /(gene.length/1000 * totalNumReads/1000000))
library(knitr)
n_distinct(groot_report$`AMR Gene Family`)
AMR_family_Groot<-groot_report%>%
group_by(`AMR Gene Family`)%>%
summarise('number of AMR genes per family (groot)'=n(),
sum_RPKM_groot=sum(RPKM))%>%arrange(desc(sum_RPKM_groot))
kable(head(AMR_family_Groot))
length(AMR_family_ARIBA$`AMR Gene Family`)
length(AMR_family_RGI$`AMR Gene Family`)
length(AMR_family_Groot$`AMR Gene Family`)
AMR_family<-merge(AMR_family_ARIBA, AMR_family_RGI[ ,1:3], by="AMR Gene Family", all=TRUE)
AMR_family<-merge(AMR_family, AMR_family_Groot, by="AMR Gene Family", all=TRUE)
kable(arrange(AMR_family,`number of AMR genes per family(ARIBA)`))
View(report)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "~/Documentos/Repos/UOC-Master/PRJNA307231")
setwd("~/Documentos/Repos/UOC-Master/PRJNA307231")
library(readr)
metadata <- read_delim("samples_metadata.csv",
"\t", escape_double = FALSE, trim_ws = TRUE)
setwd("~/Documentos/Repos/UOC-Master/PRJNA307231")
library(readr)
metadata <- read_delim("samples_metadata.csv",
"\t", escape_double = FALSE, trim_ws = TRUE)
setwd("~/Documentos/Repos/UOC-Master/PRJNA307231")
library(readr)
metadata <- read_delim("samples_metadata.csv",
"\t", escape_double = FALSE, trim_ws = TRUE)
setwd("~/Documentos/Repos/UOC-Master/PRJNA307231")
library(readr)
totalNumReads <- read_delim("totalNumReads.csv",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
names(totalNumReads)<-c("Run", "totalNumReads")
metadata<-merge(metadata, totalNumReads, by="Run")
library(readr)
totalNumReads <- read_delim("totalNumReads.csv",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
names(totalNumReads)<-c("Run", "totalNumReads")
metadata<-merge(metadata, totalNumReads, by="Run")
RGI_files<-list.files("RGI_analysis", "*.data.txt", full.names = TRUE)
RGI_data <- lapply(RGI_files, function (x) read_delim(x, delim="\t", escape_double = FALSE, trim_ws = TRUE))
for (i in 1:length(RGI_data)){
RGI_data[[i]]$RPKM<-RGI_data[[i]]$`All Mapped Reads`/(RGI_data[[i]]$`Reference Length`/1000 * metadata$totalNumReads[i]/1000000)
}
RGI_data[[1]]
metadata$totalNumReads.x
metadata$totalNumReads.y
setwd("~/Documentos/Repos/UOC-Master/PRJNA307231")
library(readr)
metadata <- read_delim("samples_metadata.csv",
"\t", escape_double = FALSE, trim_ws = TRUE)
library(readr)
totalNumReads <- read_delim("totalNumReads.csv",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
names(totalNumReads)<-c("Run", "totalNumReads")
metadata<-merge(metadata, totalNumReads, by="Run")
RGI_files<-list.files("RGI_analysis", "*.data.txt", full.names = TRUE)
RGI_data <- lapply(RGI_files, function (x) read_delim(x, delim="\t", escape_double = FALSE, trim_ws = TRUE))
RGI_files
metadata$Run
names(RGI_data)<-metadata$Run
for (i in 1:length(RGI_data)){
RGI_data[[i]]$RPKM<-RGI_data[[i]]$`All Mapped Reads`/(RGI_data[[i]]$`Reference Length`/1000 * metadata$totalNumReads[i]/1000000)
}
library(gridExtra)
install.packages("gridExtra")
library(ggplot2)
library(gridExtra)
plots<-function(x){ggplot(x, aes(`Average MAPQ (Completely Mapped Reads)`)) +
geom_histogram(bins=50)+theme_bw()}
RGI_plots<-lapply(RGI_data, plots)
grid.arrange(grobs = RGI_plots, ncol = 4)
RGI_data<-lapply(RGI_data, function(x) subset(x, x$`Average MAPQ (Completely Mapped Reads)`>10))
library(dplyr)
library(dplyr)
amrfamily<-function(x){x%>%group_by(`AMR Gene Family`)%>%summarise('number of AMR genes per family (RGI)'=n(), sum_RPKM_RGI=sum(RPKM))}
test<-RGI_data[[1]]
amrfamily(test)
library(dplyr)
amrfamily<-function(x){x%>%group_by(`AMR Gene Family`)%>%summarise('number of AMR genes per family (RGI)'=n(), sum_RPKM_RGI=sum(RPKM))}
test<-RGI_data[[1]]
test2<-amrfamily(test)
View(test2)
RGI_summary<-lapply(RGI_data, amrfamily)
